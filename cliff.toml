# cliff.toml
[changelog]
body = """
<a name="{{ version }}"></a>
# [{{ version }}]($REPO/compare/{{ previous.version }}...{{ version }}) ({{ now() | date(format="%Y-%m-%d") }})

{% for group, commits in commits | group_by(attribute="group") -%}
### {{ group }}
{% for commit in commits
| filter(attribute="scope")
| sort(attribute="scope") -%}
- **{{ commit.scope }}**: {{ commit.message }} ([{{ commit.id | truncate(length=7, end="") }}]($REPO/commit/{{ commit.id | truncate(length=7, end="") }}))
{% endfor %}
{% endfor -%}

"""
trim = false
postprocessors = [
  { pattern = '\$REPO', replace = "https://github.com/rime/librime" },
]

[git]
# 解析 commit 範圍
conventional_commits = true
filter_unconventional = false
split_commits = false
filter_commits = false
tag_pattern = "[0-9]+[.].*"
commit_preprocessors = [
  { pattern = '\((\w+\s)?#([0-9]+)\)', replace = "([#${2}](https://github.com/rime/librime/issues/${2}))" },
]

# 提交分類映射
# 根據 commit message 開頭關鍵詞自動分組
commit_parsers = [
  { message = "^feat", group = "主要功能更新 | Major Updates" },
  { message = "^fix", group = "Bug 修復 | Bug Fixes" },
  { message = "^doc", group = "文檔 | Documentation" },
  { message = "^perf", group = "性能優化 | Performance" },
  { message = "^refactor", group = "重構 | Refactor" },
  { message = "^style", group = "樣式 | Style" },
  { message = "^test", group = "測試 | Testing" },
  { message = "^build|^ci", group = "構建 | Build" },
  { message = "^chore", group = "雜項 | Miscellaneous" },
  { body = ".*security", group = "安全 | Security" },
]
