name: Commit CI
on:
  workflow_dispatch:
  push:
    tags:
      - 'v*'
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout last commit
        uses: actions/checkout@v4
      - name: Install clang-format
        run: sudo apt install -y clang-format
      - name: Lint
        run: find src -name '*.cc' -o -name '*.h' | xargs clang-format -Werror --dry-run || { echo Please lint your code by '"'"find src -name '*.cc' -o -name '*.h' | xargs clang-format -i"'"'.; false; }

  linux:
    needs: lint
    uses: ./.github/workflows/linux-build.yml

  docker:
    needs: lint
    uses: ./.github/workflows/docker-build.yml
